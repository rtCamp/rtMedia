jQuery(document).ready((function(){var e=jQuery("#rtm-importer-root");if(e.length){var t=e.data("importer"),a=parseInt(e.data("done")||0,10),i=parseInt(e.data("total")||0,10),r=parseInt(e.data("last-id")||0,10),n=String(e.data("nonce-field-id")||""),d=String(e.data("admin-ajax")||window.rtmedia_admin&&window.rtmedia_admin.rtmedia_admin_ajax||"");i<1&&jQuery("#submit").attr("disabled","disabled");var o=[];jQuery(document).on("click","#submit",(function(e){e.preventDefault(),jQuery(this).attr("disabled","disabled"),u(a,i,r)}))}function s(e){e?jQuery("#rtMediaSyncing").show():jQuery("#rtMediaSyncing").hide()}function u(e,a,i){if(e<a){s(!0);var r="";"media-size"===t?r="rtmedia_media_size_import":"activity-upgrade"===t&&(r="rtmedia_activity_upgrade");var p={action:r,done:e,last_id:i,nonce:jQuery.trim(jQuery("#"+n).val())};jQuery.ajax({url:d,type:"post",data:p}).done((function(e){var a,i;try{a=JSON.parse(e)}catch(e){return void jQuery("#submit").attr("disabled","")}if(a&&a.status){var r=parseInt(a.done,10),n=parseInt(a.total,10);!function(e,t){var a=Math.ceil(e/t*100);a>100&&(a=100),jQuery("#rtprogressbar>div").css("width",a+"%"),jQuery("span.finished").text(e),jQuery("span.total").text(t)}(r,n),i=a.pending,jQuery("span.pending").text(i),"media-size"===t?(!1===a.imported&&o.push(a.media_id),u(r,n,parseInt(a.media_id,10))):(!1===a.imported&&o.push(a.activity_id),u(r,n,parseInt(a.activity_id,10)))}else alert("Migration completed."),s(!1)})).fail((function(){alert("Error During Migration, Please Refresh Page then try again"),jQuery("#submit").removeAttr("disabled")}))}else"activity-upgrade"===t?jQuery.post(d,{action:"rtmedia_activity_done_upgrade"},(function(){alert("Database upgrade completed.")})):alert("Migration completed."),o.length>0&&("media-size"===t?jQuery("span.pending").text("Media with ID: "+o.join(", ")+" can not be imported. Please check your server error log for more details. Don't worry, you can end importing media size now :)"):jQuery("span.pending").html("Some activities are failed to upgrade, Don't worry about that.")),s(!1)}}));