function shouldRefreshComment(e){return e.classList.contains("loading")||e.querySelector(".godam-placeholder")||!e.querySelector(".comment-content")}function refreshSingleComment(e,t){const n=window.processingComments||(window.processingComments=new Set);if(n.has(e))return;n.add(e);const o=t.innerHTML;t.classList.add("loading");const r=new AbortController,a=setTimeout((()=>r.abort()),3e4);fetch(GodamAjax.ajax_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"get_single_activity_comment_html",comment_id:e,nonce:GodamAjax.nonce}),signal:r.signal}).then((e=>{if(clearTimeout(a),!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()})).then((e=>{if(!(e.success&&e.data&&e.data.html))throw new Error(e.data||"Unknown server error");{const n=t.closest(".activity-item")?.id?.replace("activity-","");if(!n)throw new Error("Could not find parent activity ID");let o=document.querySelector(`#activity-${n} .activity-comments`);if(!o){o=document.createElement("ul"),o.classList.add("activity-comments");const e=document.querySelector(`#activity-${n}`);if(!e)throw new Error("Parent activity element not found");e.appendChild(o)}const r=document.createElement("div");r.innerHTML=e.data.html;const a=r.firstElementChild;a&&(t.parentNode&&t.parentNode.replaceChild(a,t),GODAMPlayer(a))}})).catch((r=>{console.error("AJAX error for comment",e,":",r),t.innerHTML=o,t.classList.remove("loading"),"AbortError"===!r.name&&setTimeout((()=>{n.delete(e)}),5e3)})).finally((()=>{clearTimeout(a),n.delete(e),t.classList.remove("loading")}))}document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelectorAll(".activity-comments"),t=new Set;0!==e.length&&e.forEach((e=>{GODAMPlayer(e);new MutationObserver((e=>{e.forEach((e=>{e.addedNodes.forEach((e=>{if(1===e.nodeType&&e.matches('li[id^="acomment-"]')){const n=e.id.replace("acomment-","");if(t.has(n))return;setTimeout((()=>{document.getElementById(`acomment-${n}`)&&(GODAMPlayer(e),shouldRefreshComment(e)&&refreshSingleComment(n,e))}),100)}}))}))})).observe(e,{childList:!0,subtree:!0})}))}));