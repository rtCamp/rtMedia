dist: trusty
language:
- php
php:
- 5.6.4
addons:
  browserstack:
    username: 'rtcamp'
    access_key: $BROWSER_STACK_ACCESS_KEY

before_install:
    - rm -rf ~/.gnupg
before_script:
    - export PLUGIN_DIR=$(pwd)
    - sudo rm -rf /etc/mysql/
    - sudo apt-get -qq purge mysql* graphviz* && sudo apt-get -qq autoremove
    - sudo bash -c 'echo -e "[user]\n\tname = abc\n\temail = root@localhost.com" > /home/travis/.gitconfig'
    - wget -qO ee rt.cx/ee && sudo bash ee
    - sudo ee site create test.rtmedia.me --wp --user=ADMINUSER --email=krupa.nanda@rtcamp.com
      --pass=ADMINPASS
    - sudo sed -i '/^127.0.0.1/ s/$/ test.rtmedia.me/' /etc/hosts
    - sudo chmod 777 -R /var/www
    - cd /var/www/test.rtmedia.me/htdocs/wp-content/plugins/ && mkdir rtMedia
    - cd $PLUGIN_DIR
    - cp -Rf * /var/www/test.rtmedia.me/htdocs/wp-content/plugins/rtMedia/
    - cd /var/www/test.rtmedia.me/htdocs/
    - wp --allow-root plugin install https://downloads.wordpress.org/plugin/buddypress.2.8.2.zip
    - wp plugin activate --all
    - cd $PLUGIN_DIR
    - cd tests/codeception/tests/_data
    - git clone --depth=1 https://github.com/rtCamp/rtmedia-test-data.git test-data
    - cd /tmp
    - sudo apt-get install unzip && unzip BrowserStackLocal-linux-x64.zip
    - nohup ./BrowserStackLocal --key $BROWSER_STACK_ACCESS_KEY &
    - cd $PLUGIN_DIR/tests/codeception/
    - composer install
    - export PATH="$PATH:/home/travis/build/kjnanda/rtMedia/tests/codeception/vendor/bin"

script:
    - wpcept run acceptance
